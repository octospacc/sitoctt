+++
Title= "ðŸ¤¯ When hardware problems become mental (damn Raspino)"
Date= 2023-01-28
Downsync= "/it/blog/Hardware-Problems-Become-Mental.html"
Aliases= [ "/Posts/2023-01-28-Hardware-Problems-Become-Mental.html" ]
Description= "Services that collapse decreeing the end of my Reign of Terror, the days wasted saying damn to Rasperino, and 2 months of vicissitudes..."
Categories= [ "Sysadmin", "Rasperino" ]
+++

{{< noticeAutomaticTranslation it >}}



<!-- Autogenerated by ListedDownsync.js. Do not edit (unless also set "% Downsync = False") - it would be overwritten. -->

<p>Until now 2 months ago, my <strong>kingdom of Rasperino</strong> was at its <strong>maximum splendor</strong>: the Misskey instance, set up just 2 weeks earlier, < strong>it was going great</strong>, and now (almost) everything seemed destined to continue well...<br>
And instead, <strong>problems arose</strong>. Let's say it took me a little while to notice, because they developed <strong>in a strangely <strong>gradual</strong> way.</p>

<h2>The initial cracks</h2>

<p>I noticed the first truly <strong>strange</strong> thing towards the beginning of December, when I realized that <strong>the system could crash</strong> by trying to perform a very banal operation but < strong>specification</strong>: create a large archive of files (compressed or not)... with any program.<br>
This small inconvenience has, in turn, caused a <strong>secondary problem</strong>... I'll get there.<br>
However, I didn't pay too much attention to it. How could I? The rest, if left untouched, <strong>worked</strong>, <strong>apart from</strong> some slight <strong>performance degradation</strong> due to Misskey's own work.</p>



<h3>The first collapse</h3>

<p>But then, those other 2 weeks of relative peace passed, and I <a href="https://mastodon.uno/@octo/109508472717947364" rel="noopener nofollow" target="_blank">wake up </a> with the <strong>server crashed</strong>, and which <strong>dies badly</strong> after any of my manual restarts (unplugging and replugging the power supply, it's the only way). <a href="https://mastodon.uno/@octo/109518037875867744" rel="noopener nofollow" target="_blank">After 2 days</a> of <strong>very messy searching</strong> I didn't have I absolutely understood what the general cause of the problem was, but only the most serious symptom, and by now I was almost <strong>convinced</strong> that in some <em>mystical</strong> way > Misskey alone managed to take down the entire server, which instead went back to working properly without that particular software running. Well, there was some logic in my reasoning, given that in any case the <strong>average</strong> use of CPU and RAM was <strong>high</strong> (even if it didn't completely saturate). <br>
In the following days, however, with <strong>a few tests</strong> I discovered that the server was not crashing due to the microblogging server, but due to what it acts as a <strong>database< /strong>: PostgreSQL (in Docker). If I ran Misskey on my PC, but let it connect to the database on the Raspino, within a few seconds, with the arrival of so many notes, the fruity server died.</p>

<p>By now, in any case, the need to <strong>install something else</strong> was clear to me, because I was convinced that Misskey was too heavy, and never mind.<br>
For 2 days <strong>I tried Epicyon</strong>, a platform that was <strong>particular</strong> to say the least... and <a href="https://sitoctt.octt.eu.org/Posts /2022-12-26-Epicyon-Piattaforma-del-Fediverso-Durata-2-Giorni.html" rel="noopener nofollow" target="_blank">the experience was not exactly pleasant</a>, but I think was complete, given that I squeezed out four thousand words in my dedicated article. Immediately afterwards I decided to give a try to another software that I had never seen before, namely <a href="https://github.com/superseriousbusiness/gotosocial" rel="noopener nofollow" target="_blank"> GoToSocial</a>. With the latter, despite it being declared alpha quality (and in fact it has some problems), I found myself - because alas now it's all over... I'm getting there, I'm getting there - very good, but <strong>that's not the point </strong>.</p>

<h3>Increasingly suspicious problems</h3>

<p>Just a few days later, those strange <strong>crashes</strong> started appearing again, but this time they were decidedly <strong>suspicious</strong>, because the general <strong>use of resources</strong> of the system was <strong>low</strong>. I tried to read the <strong>system logs</strong> in a productive way, but my <strong>patience</strong> had now reached <strong>the limit</strong>, and with it my lucidity , so every day I looked for the slightest suspicious but legible error, fixating on that and completely ignoring <strong>the illegible error</strong> that was always in front of me.</p>

<p>By now, just <strong>out of desperation</strong>, but not because I understood through reasoning that that was the problem, I decide to <strong>change</strong> the <strong>microSD</strong> card, and Now that I've done it, I bitterly regret... <strong>not having tried before</strong>! That was the problem, reckless Maremma!<br>
The good thing is that the day before I had done a check of the file systems (ext4), both of the card and of my USB HDD, and everything had come out (approximately) clean, so I had excluded hardware problems a priori: "<em>if the files are not corrupt...</em>" I thought.<br>
At about the same time (fate decided that help had to arrive late!), however, a person gave me a hand to understand what the hell those indecipherable lines, which were something like, were saying. ..</p>

<style>
.highlight.plaintext:first-of-type { max-height: 80vh; }
</style>
<div class="highlight"><pre class="highlight plaintext"><code>Dec 27 06:32:35 kernel: [27230.964650] INFO: task kworker/2:0:21874 blocked for more than 860 seconds.
Dec 27 06:32:35 kernel: [27230.964693] Tainted: G C 5.15.76-v7+ #1597
Dec 27 06:32:35 kernel: [27230.964709] "echo 0 > /proc/sys/kernel/hung_task_timeout_secs" disables this message.
Dec 27 06:32:35 kernel: [27230.964723] task:kworker/2:0 state:D stack: 0 pid:21874 ppid: 2 flags:0x00000000
Dec 27 06:32:35 kernel: [27230.964760] Workqueue: events_freezable mmc_rescan
Dec 27 06:32:35 kernel: [27230.964801] Backtrace:
Dec 27 06:32:35 kernel: [27230.964824] [<80a4ff38>] (__schedule) from [<80a50a7c>] (schedule+0x7c/0x134)
Dec 27 06:32:35 kernel: [27230.964868] r10:81f90800 r9:ffffe000 r8:00000000 r7:00000000 r6:60000013 r5:8d368000
Dec 27 06:32:35 kernel: [27230.964884] r4:ffffe000
Dec 27 06:32:35 kernel: [27230.964896] [<80a50a00>] (schedule) from [<8083f658>] (__mmc_claim_host+0xe0/0x238)
Dec 27 06:32:35 kernel: [27230.964929] r5:81f90a18 r4:00000002
Dec 27 06:32:35 kernel: [27230.964942] [<8083f578>] (__mmc_claim_host) from [<8083f7e8>] (mmc_get_card+0x38/0x3c)
Dec 27 06:32:35 kernel: [27230.964979] r10:baaf8205 r9:00000000 r8:baaf8200 r7:00000080 r6:baaf4b80 r5:00000000
Dec 27 06:32:35 kernel: [27230.964994] r4:81f91800
Dec 27 06:32:35 kernel: [27230.965007] [<8083f7b0>] (mmc_get_card) from [<80849238>] (mmc_sd_detect+0x24/0x7c)
Dec 27 06:32:35 kernel: [27230.965039] r5:81f90800 r4:81f90800
Dec 27 06:32:35 kernel: [27230.965052] [<80849214>] (mmc_sd_detect) from [<80841ca4>] (mmc_rescan+0xac/0x2d4)
Dec 27 06:32:35 kernel: [27230.965083] r5:81f90800 r4:81f90a7c
Dec 27 06:32:35 kernel: [27230.965096] [<80841bf8>] (mmc_rescan) from [<8013e158>] (process_one_work+0x250/0x57c)
Dec 27 06:32:35 kernel: [27230.965140] r9:00000000 r8:baaf8200 r7:00000080 r6:baaf4b80 r5:8e898f00 r4:81f90a7c
Dec 27 06:32:35 kernel: [27230.965153] [<8013df08>] (process_one_work) from [<8013e4e4>] (worker_thread+0x60/0x5c4)
Dec 27 06:32:35 kernel: [27230.965195] r10:baaf4b80 r9:81003d00 r8:baaf4b98 r7:00000008 r6:baaf4b80 r5:8e898f18
Dec 27 06:32:35 kernel: [27230.965210] r4:8e898f00
Dec 27 06:32:35 kernel: [27230.965223] [<8013e484>] (worker_thread) from [<80146804>] (kthread+0x178/0x194)
Dec 27 06:32:35 kernel: [27230.965264] r10:837c4000 r9:8d3a7e74 r8:00000000 r7:8e898f00 r6:8013e484 r5:8285ee00
Dec 27 06:32:35 kernel: [27230.965279] r4:8d0d3640
Dec 27 06:32:35 kernel: [27230.965291] [<8014668c>] (kthread) from [<801000d4>] (ret_from_fork+0x14/0x20)
Dec 27 06:32:35 kernel: [27230.965321] Exception stack(0x837c5fb0 to 0x837c5ff8)
Dec 27 06:32:35 kernel: [27230.965341] 5fa0: 00000000 00000000 00000000 00000000
Dec 27 06:32:35 kernel: [27230.965363] 5fc0: 00000000 00000000 00000000 00000000 00000000 00000000 00000000 00000000
Dec 27 06:32:35 kernel: [27230.965383] 5fe0: 00000000 00000000 00000000 00000000 00000013 00000000
Dec 27 06:32:35 kernel: [27230.965405] r10:00000000 r9:00000000 r8:00000000 r7:00000000 r6:00000000 r5:8014668c
Dec 27 06:32:35 kernel: [27230.965420] r4:8285ee00
</code></pre></div>
<p><strong>Every time</strong> an error like this happened, the whole <strong>system died</strong> very badly: <strong>illness</strong> to the little bots, <strong>death</strong> strong> to the HTTP server (nginx), <strong>injuries</strong> to my article and feed aggregators (wallabag and FreshRSS), <strong>bye forever</strong> to anything that allows me to open a console via Internet on Rasperino (SSH, Telnet, and even a server set up with netcat). The only thing that kept working is the <strong>constant spitting of</strong> this exact type of <strong>error</strong> in the log file.<br>
Now, I know that <em>I'm strong</em>, but with all these strange numbers in the way <strong>I absolutely couldn't</strong> see words like <code class="prettyprint">mmc_get_card</strong> code> or <code class="prettyprint">mmc_sd_detect</code>! And so I really didn't understand that maybe, <em>just maybe</em>, the <strong>microSD</strong> <em>cagona</em> that I had chosen for Raspi at the beginning of September (among those free at home), when I put this poor little computer back to work as a server, it was <strong>tending to die</strong>.</p>

<p><img src="{{< assetsRoot >}}/Media/Misc/microSD-8GB-Generic.webp" alt="The microSD card that slowly managed to drive me mad. Note the absence of brands. "></p>

<p>I don't want to have to resort to <strong>commonplaces</strong>, but this time <strong>there's little to be done</strong>! I mean, the photo speaks for itself:</p>

<blockquote>
<p><em>The presence of a renowned brand is not a guarantee of quality, but the absence of a brand is certainly a promise of absent quality.</em></p>
</blockquote>

<p>Although on the PC the <strong>old junk card still seems to <strong>work</strong> - I was able to confirm this because at least I was able to make a data dump - <strong>I don't want to no longer have to deal with</strong>stuff like this! I note it in my mind as <em>badly</em>, therefore.<br>
Even more time was then wasted in flashing the dump onto a new card, given that the only other two cards I had available at the time were 4 and 32 GB respectively, and I really wanted to put (after deleting various logs and caches, because the previous memory was 8 GB) everything on the 4 GB one, but nothing could be done; and in the end 32 GB was.</p>



<h2>The peace violated</h2>

<p>The important thing is that, <strong>I put the new SD</strong> in the <em>raspberry server</em>, those terrifying errors no longer occurred, and the big <strong>problems</strong> they <strong>disappeared</strong>... or at least so <strong>I thought, I wanted, I hoped</strong>.<br>
If this article, which should have literally been published at the end of last year, is only being published now, there are reasons. Immediately after I had changed the SD card, <strong>I preferred to wait</strong> a few days, to see if things had really calmed down, and to avoid claiming victory too soon. <strong>I did well!</strong></p>



<h3>The suffering disk</h3>

<p>Alas, in fact, those other things seen in the logs in the past few days <strong>were not</strong> huge <strong>holes in the water</strong> (<em>still troubled</em>), in particular the <strong>errors</strong> that I immediately recognized related to the <strong>USB disk</strong>.<br>
This is something that already happened to me in the past with another USB adapter for 2.5" SATA disks, even on different machines (in the period in which I used my Nintendo Switch console as a server...), but with this one that I use now there had <strong>never been any problems</strong>. And yet now, as far as I can see, <strong>it disconnects</strong> from the host <strong>randomly</strong>, <strong>doing die</strong>all those <strong>processes</strong> that depend on the files that are on that disk, as if suddenly there were moments in which any combination of SATA adapters and USB cables does not receive enough power (both short and long), <strong>the disk still works</strong> great <strong>on PC</strong>, so <strong>the problem is</strong> clearly <strong>the Raspino</strong> >... but go and understand why!</p>

<p>They tell me that <strong>the Raspi</strong>'s USB-A ports suck by nature<sup>[<em>citation required (?)</em>]</sup>, but the point is which until recently <strong>worked</strong> (all 4)! Has a <em>diode broken</em> in my power supply? That on the board of this damned single board computer, a capacitor has <em>blown up</em>? That the electricity in my house is no longer 230V, but 229V, and therefore the transformer instead of giving 5 volts in output gives 4.98? <strong>...But what do I know.</strong><br>
Returning to the real world, the only sensible hypothesis seems to me to be this: by inserting and disconnecting the power connector in its port (micro USB-B 2.0, <em>that big shit!!!</em>) , the pins on one side or the pads on the other will have worn out, so their contact surface is smaller, so the electrical resistance is greater, and therefore the device is powered with a slightly lower voltage, and when a peripheral needs to absorb a lot, here are <em>the patatracs</em>.</p>



<h3>To try to resolve</h3>

<p>Not having another <em>Raspone</em> like it, and not having other 5V 3A power supplies, <strong>I will never discover the truth</strong>, <strong>but the solution</strong> in somehow <strong>I have to find it</strong> by force.<br>
After <strong>waiting so long</strong> that the server <strong>problems</strong> have only become bigger, and the <strong>downtime</strong> much <strong>more frequent</strong>, I decide to <strong>buy a USB-A-Y cable</strong>. At worst, even if you haven't solved the problem, it's always convenient to have a cable of this type because - despite <strong>infringing USB standards</strong> <sup id="fnref1"><a class="footnote-ref" href ="#fn1">1</a></sup>- some devices cause a lot of trouble without it, and some manufacturers of <em>shitty</em> peripherals even recommend using cables of this type in case of problems (and however, they proceed to <strong>not</strong> include one in the package, indecent!).</p>

<p><strong>Once the cable arrives</strong>, I arrange all the connections and I notice something particular: <strong>the current</strong> that comes from the second USB power supply to power the disk, <strong>can</strong> strong> go up the cable until it <strong>re-enters the Pi</strong>. The problem is not so much the <strong>cable</strong>, which works and <strong>respects</strong> all the <strong>laws of physics</strong> (even if not those of the USB standard), but more the fact that the Raspberry doesn't even have, I don't know, diodes in the USB-A ports. And it's a problem that I'm not discovering, just read <a href="https://forums.raspberrypi.com/viewtopic.php?t=44584" rel="noopener nofollow" target="_blank">on the official forum </a>. In any case, to have a circuit set up like this:</p>

<ul>
<li><strong>There are no risks</strong> for the instrumentation or the surrounding environment if you use proper power supplies upstream, and mine <em>should</em> be<sup id="fnref2"><a class="footnote-ref" href="#fn2">2</a></sup>;</li>
<li><strong>Practical problems <strong>there are, but also solutions</strong> and arrangements: I could, as they suggest on the forum, apply insulating tape on the +5V pad of the USB connector that goes at Raspantino; but for now there has been no real need, the only thing I have to pay attention to is that things are powered in this order, those few times when I find myself having to do a hard reset of the system:

<ol>
<li><strong>USB disk</strong> (connected to the Y cable port);</li>
<li><strong>Raspi</strong> (from its power port);</li>
<li>After waiting at least ~10 seconds, <strong>disk</strong> connected to the Raspberry (data connector of the Y cable connected to the Raspberry).</li>
</ol></li>
</ul>

<p>I don't know why, especially considering that it is not needed for soft reboots, but without this procedure the boot can fail.</p>

<h2>Finally, rest</h2>

<p>In the end, however, <strong>hell</strong> seems to be <strong>over</strong>, and the <strong>server</strong> is now <strong>working</strong>.< br>
The flames did some damage, however: the <strong>databases</strong> of many of my hosted services became <strong>corrupt</strong>, and of 2 in particular (GoToSocial, which I mentioned before, and Peka, a chatbot based on a Markov chain) <strong>I have backups that are too old</strong> (from weeks ago) because, with the server dying, my backup scripts never managed to work... and therefore <strong> these programs</strong> are still <strong>offline</strong> now, because <strong>I haven't yet had <strong>the strength to resign myself</strong> to restoring the ancient backups.<br>
But I <strong>buy the cable a little earlier</strong>, and turn off the server while waiting, <strong>not really, eh?</strong></p>

<p><strong>Hoping</strong> that things like this won't happen again in the short future, otherwise <strong>I will go completely and irrecoverably crazy</strong> because of these damned hardware problems, I greet you and wish you never have to <em>damn</em> as much as I do. ðŸ˜”</p>





<h2>{{% i18n notes-refs %}}</h2>

<div class="footnotes">
<ol>

<li id="fn1">
<p>It was a surprise to me too, but <strong>the USB standard prohibits Y cables</strong>: see <a href="https://compliance.usb.org/index.asp?UpdateFile= Policies#72" rel="noopener nofollow" target="_blank">Update 72</a>; translated into English,</p><blockquote><em>The use of a "Y" cable (a cable with two A connectors) is prohibited on any USB device. If a USB peripheral requires more power than that allowed by the USB specification for which it was designed, it must be self-powered.</em></blockquote> Well, how nice are the rules, but then comes reality and the think a little differently. The whole <strong>real world uses Y cables</strong> without getting too much <em>fuss</em>.Â <a href="#fnref1">â†©</a><p></p>
</li>

<li id="fn2">
<p>(Both <strong>5V</strong>) </p><ul><li>For the <strong>Pi</strong>, a <strong>3A</strong> power supply (just above <a href="https://github.com/raspberrypi/documentation/blob/develop/documentation/asciidoc/computers/raspberry-pi/power-supplies.adoc" rel="noopener nofollow" target="_blank">the suggested by Raspberry Foundation</a>) which was included in a kit (excluding computer) of accessories for the Raspante, by <strong>Aukru</strong>. Oh well, after years it didn't explode, then the reviews were good anyway, and still this brand sells new power supplies, so it's fine...</li><li>For <strong>additional</strong> power, a <strong>1A</strong> block that was included in the package of my old low-end <strong>Huawei</strong> phone (also marketed in Europe), from 2017.</li></ul>Â <a href="#fnref2">â†©</a><p></p>
</li>

</ol>
</div>
